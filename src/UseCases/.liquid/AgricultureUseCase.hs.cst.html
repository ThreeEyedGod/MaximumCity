<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>src/UseCases/AgricultureUseCase.hs</title>
</head>
<head>
<link type='text/css' rel='stylesheet' href='liquid.css' />
</head>

<body>
<hr>
Put mouse over identifiers to see inferred types
<pre><span class=hs-linenum>  1: </span><span class='hs-comment'>{-# LANGUAGE BlockArguments, GADTs, FlexibleContexts, FlexibleInstances, DataKinds, PolyKinds, ScopedTypeVariables #-}</span>
<span class=hs-linenum>  2: </span><span class='hs-comment'>{-# LANGUAGE QuasiQuotes #-}</span>
<span class=hs-linenum>  3: </span><span class='hs-comment'>{-# Language PartialTypeSignatures #-}</span>
<span class=hs-linenum>  4: </span><span class='hs-comment'>{-# Language NamedWildCards #-}</span>
<span class=hs-linenum>  5: </span><span class='hs-comment'>{-# LANGUAGE OverloadedStrings #-}</span>
<span class=hs-linenum>  6: </span>
<span class=hs-linenum>  7: </span><span class='hs-keyword'>{-@</span> <span class='hs-conid'>LIQUID</span> <span class='hs-str'>"--no-totality"</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>  8: </span><span class='hs-comment'>--{-@ LIQUID "--skip-module" @-}</span>
<span class=hs-linenum>  9: </span>
<span class=hs-linenum> 10: </span><span class='hs-keyword'>module</span> <span class='hs-conid'>UseCases.AgricultureUseCase</span> <span class='hs-layout'>(</span><span class='hs-varid'>getInfoTlgm</span><span class='hs-layout'>,</span> <span class='hs-varid'>getInfoPlainText</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 11: </span><span class='hs-keyword'>where</span>
<span class=hs-linenum> 12: </span>
<span class=hs-linenum> 13: </span><span class='hs-keyword'>import</span>           <span class='hs-conid'>Polysemy</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Sem</span><span class='hs-layout'>,</span> <span class='hs-conid'>Member</span><span class='hs-layout'>,</span> <span class='hs-conid'>Embed</span><span class='hs-layout'>,</span> <span class='hs-varid'>embed</span><span class='hs-layout'>,</span> <span class='hs-conid'>Members</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 14: </span><span class='hs-keyword'>import</span>           <span class='hs-conid'>Polysemy.Error</span>
<span class=hs-linenum> 15: </span><span class='hs-keyword'>import</span>           <span class='hs-conid'>Polysemy.Input</span>           <span class='hs-conid'>()</span>
<span class=hs-linenum> 16: </span><span class='hs-keyword'>import</span>           <span class='hs-conid'>Polysemy.Trace</span>           <span class='hs-layout'>(</span><span class='hs-conid'>Trace</span><span class='hs-layout'>,</span> <span class='hs-varid'>trace</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 17: </span><span class='hs-keyword'>import</span>           <span class='hs-conid'>UseCases.WWI</span>             <span class='hs-layout'>(</span><span class='hs-conid'>WWI</span><span class='hs-layout'>,</span> <span class='hs-conid'>PlaceName</span><span class='hs-layout'>,</span> <span class='hs-conid'>TheWeatherThere</span><span class='hs-layout'>,</span> <span class='hs-varid'>getWeatherTown</span><span class='hs-layout'>,</span> <span class='hs-varid'>sendBackMsg</span><span class='hs-layout'>,</span> <span class='hs-conid'>UserAsk</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>UserMsg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 18: </span><span class='hs-keyword'>import</span>           <span class='hs-conid'>InterfaceAdapters.Preferences</span> <span class='hs-layout'>(</span> <span class='hs-varid'>modalUser</span><span class='hs-layout'>,</span> <span class='hs-varid'>setPreferences</span><span class='hs-layout'>,</span> <span class='hs-varid'>getPreferences</span><span class='hs-layout'>,</span> <span class='hs-conid'>Preferences</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 19: </span><span class='hs-keyword'>import</span>           <span class='hs-conid'>InterfaceAdapters.Telegram.Telegram</span> <span class='hs-layout'>(</span>
<span class=hs-linenum> 20: </span>        <span class='hs-varid'>getUserIdNumber</span>
<span class=hs-linenum> 21: </span>      <span class='hs-layout'>,</span> <span class='hs-conid'>User</span> <span class='hs-layout'>(</span><span class='hs-varid'>user_id</span><span class='hs-layout'>,</span> <span class='hs-varid'>user_first_name</span> <span class='hs-layout'>,</span> <span class='hs-varid'>user_last_name</span><span class='hs-layout'>,</span> <span class='hs-varid'>user_username</span><span class='hs-layout'>,</span> <span class='hs-varid'>user_language_code</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 22: </span>      <span class='hs-layout'>,</span> <span class='hs-varid'>getUpdate_id</span>
<span class=hs-linenum> 23: </span>      <span class='hs-layout'>,</span> <span class='hs-conid'>TelegramMessage</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 24: </span>      <span class='hs-layout'>,</span> <span class='hs-varid'>gettheTelegram</span>
<span class=hs-linenum> 25: </span>      <span class='hs-layout'>,</span> <span class='hs-varid'>getMeta</span>
<span class=hs-linenum> 26: </span>      <span class='hs-layout'>,</span> <span class='hs-varid'>getUserId</span>
<span class=hs-linenum> 27: </span>      <span class='hs-layout'>,</span> <span class='hs-conid'>Update</span><span class='hs-layout'>(</span><span class='hs-conid'>Update</span><span class='hs-layout'>,</span> <span class='hs-varid'>message</span><span class='hs-layout'>,</span> <span class='hs-varid'>update_id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 28: </span><span class='hs-keyword'>import</span>           <span class='hs-conid'>InterfaceAdapters.Utils.Helper</span>
<span class=hs-linenum> 29: </span><span class='hs-keyword'>import</span>           <span class='hs-conid'>AWSLambda</span> <span class='hs-layout'>(</span><span class='hs-varid'>responseBody</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 30: </span><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data.Text.Internal</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>T</span>
<span class=hs-linenum> 31: </span><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data.Text</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>M</span>
<span class=hs-linenum> 32: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Either</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromRight</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 33: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.ByteString.Lazy.UTF8</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromString</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- from utf8-string</span>
<span class=hs-linenum> 34: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Text.RawString.QQ</span>
<span class=hs-linenum> 35: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Aeson</span> <span class='hs-layout'>(</span><span class='hs-varid'>eitherDecode</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 36: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Text.Lazy.Encoding</span> <span class='hs-layout'>(</span><span class='hs-varid'>encodeUtf8</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 37: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Text.Lazy</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromStrict</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 38: </span>
<span class=hs-linenum> 39: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Web.Telegram.API.Bot.Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>Message</span><span class='hs-layout'>,</span> <span class='hs-conid'>Message</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Message</span><span class='hs-layout'>(</span><span class='hs-varid'>text</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-conid'>User</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 40: </span>
<span class=hs-linenum> 41: </span><span class='hs-comment'>-- Liquid Haskell imports</span>
<span class=hs-linenum> 42: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Polysemy.Internal</span> <span class='hs-layout'>(</span><span class='hs-conid'>Sem</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 43: </span><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data.Text.Lazy</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Tx</span>
<span class=hs-linenum> 44: </span><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data.Text.Internal.Lazy</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>TL</span>
<span class=hs-linenum> 45: </span>
<span class=hs-linenum> 46: </span><span class='hs-definition'>getInfoTlgm</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Member</span> <span class='hs-layout'>(</span><span class='hs-conid'>Embed</span> <span class='hs-conid'>IO</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-conid'>Member</span> <span class='hs-conid'>WWI</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TelegramMessage</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Sem</span> <span class='hs-varid'>r</span> <span class='hs-conid'>TheWeatherThere</span>
<span class=hs-linenum> 47: </span><span class='hs-definition'>getInfoTlgm</span> <span class='hs-varid'>updt</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>Update</span> <span class='hs-layout'>{</span><span class='hs-varid'>message</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>m</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 48: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-layout'>(</span><span class='hs-varid'>isValidPreferencesJSON</span> <span class='hs-varop'>.</span> <span class='hs-varid'>eitherDecode</span> <span class='hs-varop'>.</span> <span class='hs-varid'>encodeUtf8</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fromStrict</span><span class='hs-layout'>)</span> <span class='hs-varid'>resp</span>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-comment'>-- if preferences are valid and a JSON format ....</span>
<span class=hs-linenum> 49: </span>                   <span class='hs-comment'>-- x &lt;- embed (setPreferences uuid resp)</span>
<span class=hs-linenum> 50: </span>                  <span class='hs-varid'>apiSetTlgm</span> <span class='hs-varid'>updt</span> 
<span class=hs-linenum> 51: </span>                  <span class='hs-varid'>sendBackMsg</span> <span class='hs-varop'>$</span> <span class='hs-varid'>theMsg</span> <span class='hs-varid'>resp</span> <span class='hs-varid'>updt</span>
<span class=hs-linenum> 52: </span>                  <span class='hs-varid'>pure</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fst</span> <span class='hs-varop'>$</span> <span class='hs-varid'>theMsg</span> <span class='hs-varid'>resp</span> <span class='hs-varid'>updt</span>
<span class=hs-linenum> 53: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 54: </span>                  <span class='hs-keyword'>case</span> <span class='hs-conid'>M.unpack</span> <span class='hs-varid'>respChecked</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum> 55: </span>                        <span class='hs-layout'>(</span><span class='hs-varid'>u1</span><span class='hs-conop'>:</span><span class='hs-varid'>u2</span><span class='hs-conop'>:</span><span class='hs-varid'>rx</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 56: </span>                              <span class='hs-varid'>responseBody</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>apiGetTlgm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Update</span> <span class='hs-layout'>{</span><span class='hs-varid'>update_id</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>updateid</span><span class='hs-layout'>}</span> <span class='hs-layout'>{</span><span class='hs-varid'>message</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>Message</span> <span class='hs-layout'>{</span><span class='hs-varid'>text</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-conid'>M.pack</span> <span class='hs-layout'>(</span><span class='hs-varid'>u1</span><span class='hs-conop'>:</span><span class='hs-varid'>u2</span><span class='hs-conop'>:</span><span class='hs-varid'>rx</span><span class='hs-layout'>)</span><span class='hs-layout'>}</span><span class='hs-layout'>{</span><span class='hs-varid'>from</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>User</span> <span class='hs-layout'>{</span><span class='hs-varid'>user_id</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getUserIdNumber</span> <span class='hs-layout'>(</span><span class='hs-varid'>from</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 57: </span>                              <span class='hs-varid'>sendBackMsg</span> <span class='hs-varop'>$</span> <span class='hs-varid'>theMsg</span> <span class='hs-varid'>responseBody</span> <span class='hs-varid'>updt</span>
<span class=hs-linenum> 58: </span>                              <span class='hs-varid'>pure</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fst</span> <span class='hs-varop'>$</span> <span class='hs-varid'>theMsg</span> <span class='hs-varid'>responseBody</span> <span class='hs-varid'>updt</span>
<span class=hs-linenum> 59: </span>                        <span class='hs-keyword'>_</span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> 
<span class=hs-linenum> 60: </span>                              <span class='hs-varid'>sendBackMsg</span> <span class='hs-varop'>$</span> <span class='hs-varid'>theMsg</span> <span class='hs-varid'>resp</span> <span class='hs-varid'>updt</span>
<span class=hs-linenum> 61: </span>                              <span class='hs-varid'>pure</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fst</span> <span class='hs-varop'>$</span> <span class='hs-varid'>theMsg</span> <span class='hs-varid'>resp</span> <span class='hs-varid'>updt</span>
<span class=hs-linenum> 62: </span>      <span class='hs-keyword'>where</span>
<span class=hs-linenum> 63: </span>            <span class='hs-comment'>--(uuid, (tlgm, resp)) = getMeta (Just updt)</span>
<span class=hs-linenum> 64: </span>            <span class='hs-varid'>resp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>gettheTelegram</span> <span class='hs-varid'>updt</span>
<span class=hs-linenum> 65: </span>            <span class='hs-varid'>updateid</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getUpdate_id</span> <span class='hs-varid'>updt</span>
<span class=hs-linenum> 66: </span>            <span class='hs-varid'>respChecked</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>filterInvalid</span> <span class='hs-varid'>resp</span>
<span class=hs-linenum> 67: </span><span class='hs-definition'>getInfoTlgm</span> <span class='hs-varid'>updt</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>Update</span> <span class='hs-layout'>{</span><span class='hs-varid'>message</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fst</span> <span class='hs-varop'>$</span> <span class='hs-varid'>theMsg</span> <span class='hs-str'>"Update:message=nothing!!"</span> <span class='hs-varid'>updt</span>
<span class=hs-linenum> 68: </span>
<span class=hs-linenum> 69: </span><span class='hs-comment'>-- Domain Data</span>
<span class=hs-linenum> 70: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>measure</span> <span class='hs-varid'>txtLen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>T.Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 71: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>measure</span> <span class='hs-varid'>gettheTelegram</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TelegramMessage</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>T.Text</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 72: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>ValidInboundMsg</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>{</span><span class='hs-varid'>tlgm</span><span class='hs-conop'>:</span> <span class='hs-conid'>TelegramMessage</span> <span class='hs-keyglyph'>|</span> <span class='hs-num'>1</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>txtLen</span> <span class='hs-layout'>(</span><span class='hs-varid'>gettheTelegram</span> <span class='hs-varid'>tlgm</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>  <span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 73: </span>
<span class=hs-linenum> 74: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>apiGetTlgm</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ValidInboundMsg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Sem</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 75: </span><span class='hs-definition'>apiGetTlgm</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Member</span> <span class='hs-layout'>(</span><span class='hs-conid'>Embed</span> <span class='hs-conid'>IO</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-conid'>Member</span> <span class='hs-conid'>WWI</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TelegramMessage</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Sem</span> <span class='hs-varid'>r</span> <span class='hs-conid'>TheWeatherThere</span>
<span class=hs-linenum> 76: </span><span class='hs-definition'>apiGetTlgm</span> <span class='hs-varid'>updt</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 77: </span>                  <span class='hs-varid'>thisuserprefs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>embed</span> <span class='hs-layout'>(</span><span class='hs-varid'>getPreferences</span> <span class='hs-varid'>uid</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 78: </span>                  <span class='hs-varid'>getWeatherTown</span> <span class='hs-varop'>$</span> <span class='hs-conid'>UserAsk</span> <span class='hs-layout'>{</span><span class='hs-varid'>placeName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>resp</span><span class='hs-layout'>,</span> <span class='hs-varid'>prefs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thisuserprefs</span><span class='hs-layout'>}</span>
<span class=hs-linenum> 79: </span>            <span class='hs-keyword'>where</span> 
<span class=hs-linenum> 80: </span>                  <span class='hs-layout'>(</span><span class='hs-varid'>uid</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>tlgm</span><span class='hs-layout'>,</span> <span class='hs-varid'>resp</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getMeta</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>updt</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 81: </span>
<span class=hs-linenum> 82: </span><span class='hs-definition'>apiSetTlgm</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Member</span> <span class='hs-layout'>(</span><span class='hs-conid'>Embed</span> <span class='hs-conid'>IO</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-conid'>Member</span> <span class='hs-conid'>WWI</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TelegramMessage</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Sem</span> <span class='hs-varid'>r</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 83: </span><span class='hs-definition'>apiSetTlgm</span> <span class='hs-varid'>updt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>embed</span> <span class='hs-layout'>(</span><span class='hs-varid'>setPreferences</span> <span class='hs-varid'>uid</span> <span class='hs-varid'>resp</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum> 84: </span>                  <span class='hs-layout'>(</span><span class='hs-varid'>uid</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>tlgm</span><span class='hs-layout'>,</span> <span class='hs-varid'>resp</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getMeta</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>updt</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 85: </span>
<span class=hs-linenum> 86: </span><span class='hs-definition'>theMsg</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>T.Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TelegramMessage</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>UserMsg</span>
<span class=hs-linenum> 87: </span><span class='hs-definition'>theMsg</span> <span class='hs-varid'>r</span> <span class='hs-varid'>u</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>UserMsg</span>
<span class=hs-linenum> 88: </span>
<span class=hs-linenum> 89: </span><span class='hs-definition'>getInfoPlainText</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Member</span> <span class='hs-layout'>(</span><span class='hs-conid'>Embed</span> <span class='hs-conid'>IO</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-conid'>Member</span> <span class='hs-conid'>WWI</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>PlaceName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Sem</span> <span class='hs-varid'>r</span> <span class='hs-conid'>TheWeatherThere</span>
<span class=hs-linenum> 90: </span><span class='hs-definition'>getInfoPlainText</span> <span class='hs-varid'>plName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>embed</span> <span class='hs-layout'>(</span><span class='hs-varid'>getPreferences</span> <span class='hs-varid'>modalUser</span><span class='hs-layout'>)</span> <span class='hs-varop'>&gt;&gt;=</span>  <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>thisuserprefs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>getWeatherTown</span> <span class='hs-varop'>$</span> <span class='hs-conid'>UserAsk</span> <span class='hs-layout'>{</span><span class='hs-varid'>placeName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>plName</span><span class='hs-layout'>,</span> <span class='hs-varid'>prefs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thisuserprefs</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 91: </span>
<span class=hs-linenum> 92: </span><span class='hs-definition'>apiGetPlainText</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Member</span> <span class='hs-layout'>(</span><span class='hs-conid'>Embed</span> <span class='hs-conid'>IO</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-conid'>Member</span> <span class='hs-conid'>WWI</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>PlaceName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Sem</span> <span class='hs-varid'>r</span> <span class='hs-conid'>TheWeatherThere</span>
<span class=hs-linenum> 93: </span><span class='hs-definition'>apiGetPlainText</span> <span class='hs-varid'>plName</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>embed</span> <span class='hs-layout'>(</span><span class='hs-varid'>getPreferences</span> <span class='hs-varid'>modalUser</span><span class='hs-layout'>)</span> <span class='hs-varop'>&gt;&gt;=</span>  <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>thisuserprefs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>getWeatherTown</span> <span class='hs-varop'>$</span> <span class='hs-conid'>UserAsk</span> <span class='hs-layout'>{</span><span class='hs-varid'>placeName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>plName</span><span class='hs-layout'>,</span> <span class='hs-varid'>prefs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thisuserprefs</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 94: </span>
<span class=hs-linenum> 95: </span><span class='hs-definition'>apiSetPlainText</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Member</span> <span class='hs-layout'>(</span><span class='hs-conid'>Embed</span> <span class='hs-conid'>IO</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-conid'>Member</span> <span class='hs-conid'>WWI</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>PlaceName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Sem</span> <span class='hs-varid'>r</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 96: </span><span class='hs-definition'>apiSetPlainText</span> <span class='hs-varid'>plName</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 97: </span>
<span class=hs-linenum> 98: </span><span class='hs-definition'>isValidPreferencesJSON</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>String</span> <span class='hs-conid'>Preferences</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<span class=hs-linenum> 99: </span><span class='hs-definition'>isValidPreferencesJSON</span> <span class='hs-varid'>json</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>json</span> <span class='hs-keyword'>of</span> 
<span class=hs-linenum>100: </span>            <span class='hs-conid'>Left</span> <span class='hs-varid'>invalid</span>                          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span> 
<span class=hs-linenum>101: </span>            <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>Preferences</span> <span class='hs-varid'>uData</span> <span class='hs-varid'>uSize</span> <span class='hs-varid'>uSpan</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<span class=hs-linenum>102: </span>
<span class=hs-linenum>103: </span><span class='hs-keyword'>{-@</span>  <span class='hs-varid'>filterInvalid</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>x</span><span class='hs-conop'>:</span><span class='hs-conid'>T.Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>o</span><span class='hs-conop'>:</span><span class='hs-conid'>T.Text</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>104: </span><span class='hs-definition'>filterInvalid</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>T.Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>T.Text</span>
<span class=hs-linenum>105: </span><span class='hs-definition'>filterInvalid</span> <span class='hs-varid'>this</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromRight</span> <span class='hs-str'>"invalid place"</span> <span class='hs-varop'>$</span> <span class='hs-varid'>placeLike</span> <span class='hs-varid'>this</span>
<span class=hs-linenum>106: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>assume</span> <span class='hs-conid'>M.pack</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>i</span><span class='hs-conop'>:</span><span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>{o:</span><span class='hs-conid'>T.Text</span> <span class='hs-keyword'>| len i == txtLen o }</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>107: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>assume</span> <span class='hs-conid'>M.unpack</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>i</span><span class='hs-conop'>:</span><span class='hs-conid'>T.Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>{o:</span><span class='hs-conid'>String</span> <span class='hs-keyword'>| len o == txtLen i }</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>108: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>assume</span> <span class='hs-conid'>Data.String.fromString</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>x</span><span class='hs-conop'>:</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>{v:</span><span class='hs-keyword'>_</span> <span class='hs-keyword'>| v ~~ x}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>109: </span>
<span class=hs-linenum>110: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>placeLike</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>x</span><span class='hs-conop'>:</span><span class='hs-conid'>T.Text</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>rv</span> <span class='hs-conop'>:</span> <span class='hs-layout'>(</span><span class='hs-conid'>Either</span> <span class='hs-conid'>T.Text</span> <span class='hs-keyword'>{rght:</span><span class='hs-conid'>T.Text</span> <span class='hs-keyword'>| 1 &lt; txtLen rght &amp;&amp; txtLen x == txtLen rght}</span><span class='hs-layout'>)</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>111: </span><span class='hs-definition'>placeLike</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>T.Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>T.Text</span> <span class='hs-conid'>T.Text</span>
<span class=hs-linenum>112: </span><span class='hs-definition'>placeLike</span> <span class='hs-varid'>empty</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Left</span> <span class='hs-str'>"Invalid"</span>
<span class=hs-linenum>113: </span><span class='hs-definition'>placeLike</span> <span class='hs-varid'>y</span>      <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-conid'>M.unpack</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>of</span> 
<span class=hs-linenum>114: </span>                        <span class='hs-layout'>(</span><span class='hs-varid'>u</span><span class='hs-conop'>:</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-varid'>y</span>
<span class=hs-linenum>115: </span>                        <span class='hs-keyword'>_</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Left</span> <span class='hs-str'>"Invalid"</span>  
<span class=hs-linenum>116: </span>                        </pre>
</body>
</html>