<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>src/InterfaceAdapters/Utils/JSONHelper.hs</title>
</head>
<head>
<link type='text/css' rel='stylesheet' href='liquid.css' />
</head>

<body>
<hr>
Put mouse over identifiers to see inferred types
<pre><span class=hs-linenum> 1: </span><a class=annot href="#"><span class=annottext>GHC.Types.Module</span>
</a><span class=hs-linenum> 2: </span><span class='hs-comment'>{-# LANGUAGE DuplicateRecordFields #-}</span>
<span class=hs-linenum> 3: </span>
<span class=hs-linenum> 4: </span><span class='hs-keyword'>module</span> <span class='hs-conid'>InterfaceAdapters.Utils.JSONHelper</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum> 5: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Aeson</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 6: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Text</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Text</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 7: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Control.Applicative</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 8: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Control.Monad</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Monad</span><span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>&gt;&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>return</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 9: </span><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data.ByteString.Lazy</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>B</span>
<span class=hs-linenum>10: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Network.HTTP.Conduit</span> <span class='hs-layout'>(</span><span class='hs-varid'>simpleHttp</span><span class='hs-layout'>)</span>
<span class=hs-linenum>11: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Control.Exception</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>X</span> <span class='hs-layout'>(</span> <span class='hs-conid'>SomeException</span><span class='hs-layout'>,</span> <span class='hs-varid'>catch</span> <span class='hs-layout'>)</span>
<span class=hs-linenum>12: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Generics</span> <span class='hs-conid'>()</span>
<span class=hs-linenum>13: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span>
<span class=hs-linenum>14: </span><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data.Text</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Data.ByteString.Char8</span>
<span class=hs-linenum>15: </span>
<span class=hs-linenum>16: </span><span class='hs-comment'>{-- testing 
import Data.Aeson
import Data.ByteString.Lazy
import Data.ByteString.Lazy.Char8 (unlines)
import Control.Monad (mzero)
import Control.Applicative ((&lt;$&gt;), (&lt;*&gt;))
import Prelude hiding (unlines)

testJson :: ByteString
testJson = Data.ByteString.Lazy.Char8.unlines
    [ "[" 
    ,  "{"
    , "  \"age\": 25,"
    , "  \"name\": {"
    , "    \"first\": \"John\","
    , "    \"last\": \"Doe\""
    , "  }"
    , "}"
    , ","
    ,"{"
    , "  \"age\": 26,"
    , "  \"name\": {"
    , "    \"first\": \"John1\","
    , "    \"last\": \"Doe1\""
    , "  }"
    , "}"
    ,"]"
    ]

data Name = Name
    { firstName :: String
    , lastName :: String
    } deriving (Eq, Show)

data Person = Person
    { personName :: Name
    , personAge :: Int
    } deriving (Eq, Show)

instance FromJSON Name where
    parseJSON (Object v) = do
        first &lt;- v .: "first"
        last  &lt;- v .: "last"
        return $ Name first last
    parseJSON _ = mzero

instance FromJSON Person where
    parseJSON (Object v) = do
        nameObj &lt;- v .: "name"
        name    &lt;- parseJSON nameObj
        age     &lt;- v .: "age"
        return $ Person name age


tryS :: IO ()
tryS = case decode testJson :: Maybe [Person] of
    Just person -&gt; print $ personAge $ (Prelude.take 1 person)!!0
    Nothing -&gt; Prelude.putStrLn "Couldn't parse the JSON data"

-- end testing --}</span>
<span class=hs-linenum>76: </span>
<span class=hs-linenum>77: </span>
<span class=hs-linenum>78: </span><span class='hs-definition'>jsonURL</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<span class=hs-linenum>79: </span><a class=annot href="#"><span class=annottext>[GHC.Types.Char] -&gt; Data.Text.Internal.Text -&gt; [GHC.Types.Char]</span><span class='hs-definition'>jsonURL</span></a> <a class=annot href="#"><span class=annottext>[GHC.Types.Char]</span><span class='hs-varid'>u</span></a> <a class=annot href="#"><span class=annottext>Data.Text.Internal.Text</span><span class='hs-varid'>q</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : [GHC.Types.Char] | v == u
                        &amp;&amp; len v &gt;= 0}</span><span class='hs-varid'>u</span></a> <span class='hs-varop'>++</span> <a class=annot href="#"><span class=annottext>[GHC.Types.Char]</span><span class='hs-conid'>Data.ByteString.Char8.unpack</span></a> <a class=annot href="#"><span class=annottext>{v : Data.Text.Internal.Text | v == q}</span><span class='hs-varid'>q</span></a>
<span class=hs-linenum>80: </span>
<span class=hs-linenum>81: </span><span class='hs-definition'>exceptionHandler</span> <span class='hs-keyglyph'>::</span>  <span class='hs-conid'>SomeException</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>B.ByteString</span>
<span class=hs-linenum>82: </span><a class=annot href="#"><span class=annottext>GHC.Exception.Type.SomeException -&gt; (GHC.Types.IO Data.ByteString.Lazy.Internal.ByteString)</span><span class='hs-definition'>exceptionHandler</span></a> <a class=annot href="#"><span class=annottext>GHC.Exception.Type.SomeException</span><span class='hs-varid'>e</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>(GHC.Types.IO ())</span><span class='hs-varid'>putStrLn</span></a> <a class=annot href="#"><span class=annottext>[GHC.Types.Char]</span><span class='hs-str'>"Caught an exception "</span></a> <span class='hs-varop'>&gt;&gt;</span> <a class=annot href="#"><span class=annottext>(GHC.Types.IO Data.ByteString.Lazy.Internal.ByteString)</span><span class='hs-varid'>return</span></a> <a class=annot href="#"><span class=annottext>{v : Data.ByteString.Lazy.Internal.ByteString | v == empty}</span><span class='hs-conid'>B.empty</span></a>
<span class=hs-linenum>83: </span>
<span class=hs-linenum>84: </span><span class='hs-definition'>getJSON</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>B.ByteString</span>
<span class=hs-linenum>85: </span><a class=annot href="#"><span class=annottext>[GHC.Types.Char] -&gt; Data.Text.Internal.Text -&gt; (GHC.Types.IO Data.ByteString.Lazy.Internal.ByteString)</span><span class='hs-definition'>getJSON</span></a> <a class=annot href="#"><span class=annottext>[GHC.Types.Char]</span><span class='hs-varid'>url</span></a> <a class=annot href="#"><span class=annottext>Data.Text.Internal.Text</span><span class='hs-varid'>parm</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>(GHC.Types.IO Data.ByteString.Lazy.Internal.ByteString)</span><span class='hs-varid'>simpleHttp</span></a> <a class=annot href="#"><span class=annottext>[GHC.Types.Char]</span><span class='hs-layout'>(</span></a><span class='hs-varid'>jsonURL</span> <a class=annot href="#"><span class=annottext>{v : [GHC.Types.Char] | v == url
                        &amp;&amp; len v &gt;= 0}</span><span class='hs-varid'>url</span></a> <a class=annot href="#"><span class=annottext>{v : Data.Text.Internal.Text | v == parm}</span><span class='hs-varid'>parm</span></a><span class='hs-layout'>)</span> <span class='hs-varop'>`X.catch`</span> <a class=annot href="#"><span class=annottext>GHC.Exception.Type.SomeException -&gt; (GHC.Types.IO Data.ByteString.Lazy.Internal.ByteString)</span><span class='hs-varid'>exceptionHandler</span></a>
</pre>
</body>
</html>